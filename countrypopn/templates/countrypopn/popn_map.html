<html>
{% load leaflet_tags %}
{% leaflet_css %}
{% leaflet_js %}
<style>
.legend {
    line-height: 18px;
    color: #555;
}
.legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
}
html, body {
    height: 100%;
}

#map {
    height: 100%;
}
</style>
<body>
<div id="map" style="height: 610px; width:100%">
        <h2><center>Population Density map of Nepal (people per sq. KM)</center></h2>
    {% leaflet_map "main" callback="map_init" %}
</div>
</body>
<script>
    function getColor(d) {
    return d > 1000 ? '#800026' :
           d > 500  ? '#BD0026' :
           d > 200  ? '#E31A1C' :
           d > 100  ? '#FC4E2A' :
           d > 50   ? '#FD8D3C' :
           d > 20   ? '#FEB24C' :
           d > 10   ? '#FED976' :
                      '#FFEDA0';
    }
    function style(feature) {
    return {
        fillColor: getColor((feature.properties.pop_total/feature.properties.area_sq_km)),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
    };
}


function map_init(map, options) {
        // get point lat and lon
        // zoom to point & add it to map
        var obj = JSON.parse("{{ my_geo_json | escapejs }}");
        map.setView([27.700769, 85.300140], 6);
        L.geoJson(obj, {style: style}).addTo(map);
    }

    var legend = L.control({position: 'bottomright'});

legend.onAdd = function (map) {

    var div = L.DomUtil.create('div', 'info legend'),
        grades = [0, 10, 20, 50, 100, 200, 500, 1000],
        labels = [];

    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
            '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
            grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
    }

    return div;
};

legend.addTo(map);
</script>
</html>>